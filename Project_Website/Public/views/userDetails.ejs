<!DOCTYPE html>
<html lang='en'>
<!-- Form to key in additional user details and store in database. -->

<head>
  <meta charset='UTF-8' />
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0' />
  <title>Additional Details</title>
  <!-- File in /form/style.css -->
  <link rel="stylesheet" href="/style.css" type="text/css" />
  <!-- Firebase setup. -->
  <script src="https://www.gstatic.com/firebasejs/5.1.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.1.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.1.0/firebase-firestore.js"></script>
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyDqlaeDVox13ySVHHh0ukCyZepg7QyD0B4",
      authDomain: "sgcomps-b8fdc.firebaseapp.com",
      databaseURL: "https://sgcomps-b8fdc.firebaseio.com",
      projectId: "sgcomps-b8fdc",
      storageBucket: "sgcomps-b8fdc.appspot.com",
      messagingSenderId: "1048240965389"
    };
    firebase.initializeApp(config);
  </script>
</head>
<!-- onload document function to determine which form to load. See function for more details. -->

<body onload='chooseLayout()'>
  <div class="form-header">
    <% if (Object.keys(errors).length === 0) { %>
      <h2>Send us a message</h2>
      <% } else { %>
        <h2 class="errors-heading">Oops, please correct the following:</h2>
        <ul class="errors-list">
          <% Object.values(errors).forEach(error => { %>
            <li>
              <% error.msg %>
            </li>
            <% }) %>
        </ul>
        <% } %>
  </div>

  <fieldset id='first'>
    <h2 class="title">Choose Account Type</h2>
    <input class='btn' id="student" onclick="stud_profile()" type="button" value="Student">
    <input class='btn' id="organisation" onclick="org_profile()" type="button" value="Organisation">
  </fieldset>
  <fieldset id='second'>
    <!--****** Student set-up form  ******-->
    <form method="post" action="/stud_detail" novalidate>
      <h2 class='sub-title'>Student Set-Up</h2>
      <div class='userInfo'>
        <input name='display-name' type='text' id='display-name'/>
        <input name='email' type='text' id='email'/>
        <input name='uid' type='text' id='uid'/>
      </div>
      <!-- Student Gender. -->
      <div class="form-field <% errors.message ? 'form-field-invalid' : '' %>">
        <label for="gender" id="gender_label">Gender</label>
        <input class="<% data.gender ? (data.gender == 'male' ? 'radio-checked' : '') : '' %>"
         name="gender" type="radio" value="male">Male
        <input class="<% data.gender ? (data.gender == 'female' ? 'radio-checked' : '') : '' %>" 
        name="gender" type="radio" value="female">Female

        <% if (errors.gender) { %>
          <div class="error">
            <% errors.gender.msg %>
          </div>
          <% } %>
      </div>
      <!-- Student's current school. -->
      <div class="form-field <% errors.message ? 'form-field-invalid' : '' %>">
        <label for='school'>Current University</label>
        <select name='school'>
          <option value=''>--Select University--</option>
          <option class="<% data.school ? (data.school == 'nus' ? 'select-check' : '') : '' %>" 
          value="nus">National University of Singapore(NUS)</option>
          <option class="<% data.school ? (data.school == 'ntu' ? 'select-check' : '') : '' %>"
          value="ntu">Nanyang Technological University(NTU)</option>
          <option class="<% data.school ? (data.school == 'smu' ? 'select-check' : '') : '' %>"
          value="smu">Singapore Management University(SMU)</option>
          <option class="<% data.school ? (data.school == 'sutd' ? 'select-check' : '') : '' %>"
          value="sutd">Singapore University of Technology and Design(SUTD)</option>
        </select>

        <% if (errors.school) { %>
          <div class="error">
            <% errors.school.msg %>
          </div>
          <% } %>
      </div>
      <!-- Student's current course. -->
      <div class="form-field <% errors.message ? 'form-field-invalid' : '' %>">
        <label for='course'>Course</label>
        <select name='course'>
          <option value=''>--Select Course--</option>
          <option class="<% data.course ? (data.course == 'computing' ? 'select-check' : '') : '' %>"
          value='computing'>Computing</option>
          <option class="<% data.course ? (data.course == 'arts' ? 'select-check' : '') : '' %>"
          value='arts'>Arts</option>
          <option class="<% data.course ? (data.course == 'science' ? 'select-check' : '') : '' %>"
          value='science'>Science</option>
          <option class="<% data.course ? (data.course == 'business' ? 'select-check' : '') : '' %>"
          value='business'>Business</option>
        </select>

        <% if (errors.course) { %>
          <div class="error">
            <% errors.course.msg %>
          </div>
          <% } %>
      </div>
      <!-- Competition types selection checkbox. -->
      <div class="form-field <% errors.message ? 'form-field-invalid' : '' %>">
        <label for='comp_type'>Interests:</label>
        <!-- Checks whether the box was ticked when form is submitted with error. -->
        <input class="<% data.comp_type ? (data.comp_type.indexOf('analytics') > -1 ? 'checked' : '') : '' %>" name='comp_type'
          type='checkbox' value='analytics' />
        <span>Analytics</span>
        <input class="<% data.comp_type ? (data.comp_type.indexOf('accounting') > -1 ? 'checked' : '') : '' %>" name='comp_type'
          type='checkbox' value='accounting' />
        <span>Accounting</span>
        <input class="<% data.comp_type ? (data.comp_type.indexOf('business') > -1 ? 'checked' : '') : '' %>" name='comp_type' type='checkbox'
          value='business' />
        <span>Business</span>
        </br>
        <input class="<% data.comp_type ? (data.comp_type.indexOf('computer-science') > -1 ? 'checked' : '') : '' %>" name='comp_type'
          type='checkbox' value='computer-science' />
        <span>Computer Science</span>

        <% if (errors.comp_type) { %>
          <div class="error">
            <% errors.comp_type.msg %>
          </div>
          <% } %>
      </div>
      <!-- Short introduction of student -->
      <div class="form-field <% errors.message ? 'form-field-invalid' : '' %>">
        <label for="message">Short Introduction:</label>
        <textarea class="input" id="message" name="message" rows="4" autofocus>
          <% data.message %>
        </textarea>
        <% if (errors.message) { %>
          <div class="error">
            <% errors.message.msg %>
          </div>
          <% } %>
      </div>
      <!-- Form buttons: Submit/Back -->
      <div class="form-actions">
        <button class="btn" type="submit">Send</button>
        <input class='btn prev_btn' onclick="prev_step()" type="button" value="Previous">
      </div>
    </form>
  </fieldset>

  <fieldset id='third'>
    <h2 class='sub-title'>Organisation Set-Up</h2>
    <!--****** Organisation set-up form  ******-->
    <form method="post" action="/org_detail" novalidate>
    <div class='userInfo'>
        <input name='email' type='text' id='email'/>
        <input name='uid' type='text' id='uid'/>
      </div>
      <!-- Organisation name -->
      <div class="form-field <% errors.org_name ? 'form-field-invalid' : '' %>">
        <label for="org_name">Name of Organisation:</label>
        <input class="input" id="org_name" name="org_name" type="text" value="<% data.org_name %>" />
        <% if (errors.org_name) { %>
          <div class="error">
            <% errors.org_name.msg %>
          </div>
          <% } %>
      </div>
      <!-- Competition types selection checkbox. -->
      <div class="form-field <% errors.message ? 'form-field-invalid' : '' %>">
        <label for='comp_type'>Competition Types:</label>
        <!-- Checks whether the box was ticked when form is submitted with error. -->
        <input class="<% data.comp_type ? (data.comp_type.indexOf('analytics') > -1 ? 'checked' : '') : '' %>" name='comp_type'
          type='checkbox' value='analytics' />
        <span>Analytics</span>
        <input class="<% data.comp_type ? (data.comp_type.indexOf('accounting') > -1 ? 'checked' : '') : '' %>" name='comp_type'
          type='checkbox' value='accounting' />
        <span>Accounting</span>
        <input class="<% data.comp_type ? (data.comp_type.indexOf('business') > -1 ? 'checked' : '') : '' %>" name='comp_type' type='checkbox'
          value='business' />
        <span>Business</span>
        </br>
        <input class="<% data.comp_type ? (data.comp_type.indexOf('computer-science') > -1 ? 'checked' : '') : '' %>" name='comp_type'
          type='checkbox' value='computer-science' />
        <span>Computer Science</span>

        <% if (errors.comp_type) { %>
          <div class="error">
            <% errors.comp_type.msg %>
          </div>
          <% } %>
      </div>
      <!-- Short description of organisation. -->
      <div class="form-field <% errors.message ? 'form-field-invalid' : '' %>">
        <label for="message">Short Description:</label>
        <textarea class="input" id="message" name="message" rows="4" autofocus>
          <% data.message %>
        </textarea>
        <% if (errors.message) { %>
          <div class="error">
            <% errors.message.msg %>
          </div>
          <% } %>
      </div>
      <!-- Form buttons: Submit/Back -->
      <div class="form-actions">
        <button class="btn" type="submit">Send</button>
        <input class='btn prev_btn' onclick="prev_step()" type="button" value="Previous">
      </div>
    </form>
  </fieldset>

  <script>
    // Simple functions to toggle form view.

    // Function called to determine if page is rendered from login screen or
    // due to errors in form. Calls appropiate page view.
    function chooseLayout() {
      let url = window.location.href
      let urlType = url.split('/')
      // Get "contact", "stud_detail" or "org_detail" at end of string to 
      // Differentiate different calls of page render [See routes.js]
      if (urlType[urlType.length - 1] == 'stud_detail') {
        stud_profile()
      } else if (urlType[urlType.length - 1] == 'org_detail') {
        org_profile()
      }
      // Re-check required boxes when page loads.
      let box_check = document.getElementsByClassName('checked')
      console.log(box_check)
      for (let i = 0; i < box_check.length; i++) {
        box_check[i].checked = true
      }
      // Re-Select correct value for radio buttons when page loads.
      let radio_check = document.getElementsByClassName('radio-checked')
      console.log(radio_check)
      radio_check[0].checked = true
      // Re-Select correct value for select options when page loads.
      let select_check = document.getElementsByClassName('select-check')
      console.log(select_check)
      for (let i = 0; i < select_check.length; i++) {
        select_check[i].selected = true;
      }
    }

    // Hides selection fieldset and displays student profile form.
    function stud_profile() {
      document.getElementById('first').style.display = "none"
      document.getElementById('second').style.display = "block"
    }

    // Hides other fieldsets and displays selection fieldset.
    function prev_step() {
      document.getElementById('first').style.display = "block"
      document.getElementById('second').style.display = "none"
      document.getElementById('third').style.display = "none"
    }

    // Hides selection fieldset and displays organisation profile form.
    function org_profile() {
      document.getElementById('first').style.display = "none"
      document.getElementById('third').style.display = "block"
    }
  </script>
  <script>
    let basicInfo = firebase.auth().onAuthStateChanged(user => {
      if (user) {
       //User is signed in.
       document.getElementById('display-name').value = user.displayName
       document.getElementById('email').value = user.email
       document.getElementById('uid').value = user.uid
     }
    })
  </script>
</body>

</html>